container_commands:
  01_composer_install:
    command: |
      # Ensure Composer is installed
      if ! command -v composer &> /dev/null; then
          echo "Composer is not installed. Installing Composer..."
          curl -sS https://getcomposer.org/installer  | php
          mv composer.phar /usr/local/bin/composer
          chmod +x /usr/local/bin/composer
      fi

      # Run Composer install with production flags
      echo "Running 'composer install --no-dev --optimize-autoloader'..."
      composer install --no-dev --optimize-autoloader --no-interaction
      if [ $? -ne 0 ]; then
          echo "Failed to run 'composer install'."
          exit 1
      fi
    cwd: "/var/app/staging"